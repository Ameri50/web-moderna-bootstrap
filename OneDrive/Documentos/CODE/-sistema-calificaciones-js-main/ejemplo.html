<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Estudiantes</title>
</head>
<body>
  <h1>Sistema de Gestión de Estudiantes</h1>
  <script>
    // 1. Estructura Base de Datos
    const estudiantes = [
      {
        id: 1,
        nombre: "Juan",
        calificaciones: [85, 90, 78],
        asistencia: true,
        estado: "activo"
      }
    ];

    // 2. Funciones de Control

    // Agregar estudiante con validaciones
    function agregarEstudiante(nombre, calificaciones, asistencia = true, estado = "activo") {
      if (!nombre || !Array.isArray(calificaciones) || calificaciones.some(c => c < 0 || c > 100)) {
        console.error("Datos inválidos. Verifica el nombre y las calificaciones.");
        return;
      }
      const nuevoEstudiante = {
        id: estudiantes.length + 1,
        nombre,
        calificaciones,
        asistencia,
        estado
      };
      estudiantes.push(nuevoEstudiante);
      console.log(`Estudiante ${nombre} agregado.`);
    }

    // Calcular promedio usando bucles
    function calcularPromedio(calificaciones) {
      return calificaciones.reduce((sum, calificacion) => sum + calificacion, 0) / calificaciones.length;
    }

    // Filtrar estudiantes por estado
    function filtrarPorEstado(estado) {
      return estudiantes.filter(estudiante => estudiante.estado === estado);
    }

    // 3. Condicionales y Validaciones

    // Validar si un estudiante aprobó
    function determinarAprobado(promedio) {
      return promedio >= 70;
    }

    // Clasificar estudiantes según promedio
    function clasificarEstudiante(promedio) {
      if (promedio >= 90) return "Excelente";
      if (promedio >= 80) return "Bueno";
      if (promedio >= 70) return "Regular";
      return "Necesita Mejorar";
    }

    // 4. Implementación de Bucles

    // Mostrar lista de estudiantes
    function mostrarEstudiantes() {
      for (const estudiante of estudiantes) {
        const promedio = calcularPromedio(estudiante.calificaciones);
        console.log(`Nombre: ${estudiante.nombre}, Promedio: ${promedio}`);
      }
    }

    // Actualizar estado basado en promedio
    function actualizarEstados() {
      for (const estudiante of estudiantes) {
        const promedio = calcularPromedio(estudiante.calificaciones);
        estudiante.estado = determinarAprobado(promedio) ? "activo" : "inactivo";
      }
    }

    // Generar reportes
    function generarReporte() {
      estudiantes.forEach(estudiante => {
        const promedio = calcularPromedio(estudiante.calificaciones);
        const clasificacion = clasificarEstudiante(promedio);
        console.log(`Estudiante: ${estudiante.nombre}, Promedio: ${promedio}, Clasificación: ${clasificacion}`);
      });
    }

    // Logros Adicionales

    // Búsqueda de estudiantes por nombre
    function buscarPorNombre(nombre) {
      return estudiantes.filter(estudiante => estudiante.nombre.toLowerCase().includes(nombre.toLowerCase()));
    }

    // Ordenamiento por promedio
    function ordenarPorPromedio() {
      estudiantes.sort((a, b) => calcularPromedio(b.calificaciones) - calcularPromedio(a.calificaciones));
    }

    // Sistema de rangos basado en asistencia y calificaciones
    function generarRangos() {
      return estudiantes.map(estudiante => {
        const promedio = calcularPromedio(estudiante.calificaciones);
        return {
          nombre: estudiante.nombre,
          asistencia: estudiante.asistencia ? "Asistió" : "Faltó",
          promedio,
          clasificacion: clasificarEstudiante(promedio)
        };
      });
    }

    // Persistencia de datos usando localStorage
    function guardarDatos() {
      localStorage.setItem("estudiantes", JSON.stringify(estudiantes));
      console.log("Datos guardados en localStorage.");
    }

    function cargarDatos() {
      const datos = JSON.parse(localStorage.getItem("estudiantes"));
      if (datos) {
        estudiantes.length = 0;
        estudiantes.push(...datos);
        console.log("Datos cargados desde localStorage.");
      } else {
        console.log("No hay datos almacenados.");
      }
    }

    // Ejemplo de uso
    agregarEstudiante("Ana", [95, 88, 92]);
    agregarEstudiante("Carlos", [60, 70, 65]);
    mostrarEstudiantes();
    actualizarEstados();
    generarReporte();
    ordenarPorPromedio();
    console.log(generarRangos());
    guardarDatos();
    cargarDatos();
  </script>
</body>
</html>
